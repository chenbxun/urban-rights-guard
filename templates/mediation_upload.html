{% extends "base.html" %}

{% block content %}
<div class="row mt-4">

    <div class="col-md-3 mb-4">
        <div class="card shadow-sm border-0">
            <div class="card-header bg-primary text-white fw-bold py-3">
                âš–ï¸ è°ƒè§£æœåŠ¡å¤§å…
            </div>
            <div class="list-group list-group-flush">
                <a href="/mediation/apply" class="list-group-item list-group-item-action py-3 d-flex justify-content-between align-items-center">
                    å¿«é€Ÿè°ƒè§£å…¥å£
                    <span class="badge bg-danger rounded-pill">Hot</span>
                </a>
                <a href="/mediation/status" class="list-group-item list-group-item-action py-3">
                    çº çº·è°ƒè§£è¿›åº¦æŸ¥è¯¢
                </a>
                <a href="/mediation/upload" class="list-group-item list-group-item-action py-3 sidebar-active">
                    å½•åƒ/å½•éŸ³ä¸Šä¼ 
                </a>
                <a href="/mediation/download" class="list-group-item list-group-item-action py-3">
                    å½•åƒ/å½•éŸ³ä¸‹è½½
                </a>
                <a href="/mediation/hotline" class="list-group-item list-group-item-action py-3 text-muted">
                    <small>24å°æ—¶äººå·¥çƒ­çº¿</small>
                </a>
            </div>
        </div>
        
        <div class="alert alert-info mt-3 shadow-sm border-0 small">
            <i class="bi bi-info-circle-fill"></i> æç¤ºï¼š
            ä¸Šä¼ å½•éŸ³å½•åƒå‰ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼ä¸º MP3 æˆ– MP4ï¼Œå¤§å°ä¸è¶…è¿‡ 500Mã€‚
        </div>
    </div>

    <div class="col-md-9">
        <div class="card shadow border-0">
            <div class="card-header bg-white border-bottom py-3 d-flex justify-content-between align-items-center">
                <h4 class="fw-bold text-primary mb-0">ğŸ“¹ å½•éŸ³å½•åƒå–è¯ä¸Šä¼ </h4>
                <a href="/mediation" class="btn btn-outline-secondary btn-sm">
                    &lt; è¿”å›ä¸“å®¶åˆ—è¡¨
                </a>
            </div>
            <div class="card-body p-5">
                
                <form action="/mediation/upload/submit" method="post" enctype="multipart/form-data">
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">é€‰æ‹©æ–‡ä»¶ <span class="text-danger">*</span></label>
                        <input type="file" name="file" class="form-control form-control-lg" accept="audio/*,video/*" required>
                        <div class="form-text text-muted">
                            è¯·ä¸Šä¼ ä¸çº çº·ç›¸å…³çš„ç°åœºå½•éŸ³æˆ–ç›‘æ§å½•åƒæ–‡ä»¶ã€‚
                        </div>
                    </div>

                    <div class="mb-5">
                        <label class="form-label fw-bold">éªŒè¯ç  <span class="text-danger">*</span></label>
                        <div class="d-flex align-items-center">
                            <input type="text" name="captcha_input" class="form-control form-control-lg me-3" style="width: 150px;" placeholder="ä¸åˆ†å¤§å°å†™" required>
                            
                            <input type="hidden" name="captcha_id" id="captcha_id_field">
                            
                            <div style="cursor: pointer;" onclick="refreshCaptcha()" title="ç‚¹å‡»æ›´æ¢">
                                <img id="captcha_img" src="" alt="åŠ è½½ä¸­..." style="height: 50px; border: 1px solid #ccc; border-radius: 4px;">
                            </div>
                            <small class="text-muted ms-2 user-select-none" onclick="refreshCaptcha()" style="cursor: pointer;">çœ‹ä¸æ¸…ï¼Ÿæ¢ä¸€å¼ </small>
                        </div>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-primary btn-lg py-3">ç¡®è®¤ä¸Šä¼ æ–‡ä»¶</button>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

<style>
    /* ä¾§è¾¹æ é€‰ä¸­æ ·å¼ */
    .sidebar-active {
        background-color: #fff !important;
        color: #0d6efd !important;
        font-weight: bold;
        border-left: 5px solid #0d6efd !important;
        padding-left: 15px !important;
        box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }
</style>

<script>
    // ç”Ÿæˆéšæœº ID
    function generateUUID() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    // åˆ·æ–°éªŒè¯ç 
    function refreshCaptcha() {
        var oldId = document.getElementById('captcha_id_field').value;
        var newId = generateUUID();
        document.getElementById('captcha_id_field').value = newId;

        var imgUrl = "/mediation/captcha/" + newId + "?old_uid=" + oldId + "&t=" + new Date().getTime();
        document.getElementById('captcha_img').src = imgUrl;
    }

    // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡
    window.onload = function() {
        refreshCaptcha();
    }
</script>
{% endblock %}